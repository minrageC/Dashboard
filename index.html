<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plano Diário — 2.000 → 300.000 MZN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    .num { font-variant-numeric: tabular-nums; }
    table { border-collapse: collapse; }
    th, td { border-bottom: 1px solid #e5e7eb; }
    .sticky-th { position: sticky; top: 0; background: white; box-shadow: 0 1px 0 #e5e7eb; z-index: 1; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <main class="max-w-6xl mx-auto p-4 md:p-8">
    <header class="mb-6">
      <h1 class="text-2xl md:text-3xl font-bold">Plano diário — 2.000 MZN → 300.000 MZN</h1>
      <p class="text-sm text-gray-600">Período: <span id="periodo" class="font-medium">01/09/2025 → 31/01/2026</span> • Dias (inclusivos): <span id="dias" class="font-medium num"></span></p>
    </header>

    <section class="grid md:grid-cols-2 gap-4 mb-6">
      <!-- Parâmetros -->
      <div class="bg-white rounded-2xl shadow p-4 md:p-6">
        <h2 class="text-lg font-semibold mb-4">Parâmetros</h2>
        <div class="grid grid-cols-2 gap-3">
          <label class="text-sm">Banca inicial (MZN)
            <input id="banca" type="number" class="w-full mt-1 rounded-xl border p-2 num" value="2000" min="1" />
          </label>
          <label class="text-sm">Meta final (MZN)
            <input id="meta" type="number" class="w-full mt-1 rounded-xl border p-2 num" value="300000" min="1" />
          </label>
          <label class="text-sm">Início
            <input id="inicio" type="date" class="w-full mt-1 rounded-xl border p-2" value="2025-09-01" />
          </label>
          <label class="text-sm">Fim
            <input id="fim" type="date" class="w-full mt-1 rounded-xl border p-2" value="2026-01-31" />
          </label>
          <label class="text-sm">Entradas/dia (máx)
            <input id="entradas" type="number" class="w-full mt-1 rounded-xl border p-2 num" value="4" min="1" max="20" />
          </label>
          <label class="text-sm">Stop-loss diário (% da banca)
            <input id="slPct" type="number" class="w-full mt-1 rounded-xl border p-2 num" value="2.5" step="0.1" />
          </label>
        </div>
        <div class="mt-4 flex gap-2">
          <button id="recalcular" class="px-4 py-2 rounded-xl bg-black text-white shadow">Recalcular</button>
          <button id="exportar" class="px-4 py-2 rounded-xl bg-gray-800 text-white shadow">Exportar CSV</button>
          <button id="imprimir" class="px-4 py-2 rounded-xl bg-gray-200 shadow">Imprimir</button>
        </div>
      </div>

      <!-- Resumo do dia 1 -->
      <div class="bg-white rounded-2xl shadow p-4 md:p-6">
        <h2 class="text-lg font-semibold mb-3">Resumo (Dia 1)</h2>
        <div class="grid grid-cols-2 gap-3 text-sm">
          <div class="p-3 rounded-xl bg-gray-50">
            <div class="text-gray-500">Crescimento diário necessário</div>
            <div class="text-xl font-bold num" id="rPct">—</div>
          </div>
          <div class="p-3 rounded-xl bg-gray-50">
            <div class="text-gray-500">Lucro meta do dia 1</div>
            <div class="text-xl font-bold num"><span id="lucroDia1">—</span> MZN</div>
          </div>
          <div class="col-span-2 p-3 rounded-xl bg-gray-50">
            <div class="text-gray-500 mb-2">Stake sugerida p/ 1 acerto (Dia 1)</div>
            <div class="grid grid-cols-4 gap-2 text-center">
              <div class="p-2 rounded-lg bg-white border"><div class="text-xs text-gray-500">1.5x</div><div class="font-semibold num" id="s15">—</div></div>
              <div class="p-2 rounded-lg bg-white border"><div class="text-xs text-gray-500">1.8x</div><div class="font-semibold num" id="s18">—</div></div>
              <div class="p-2 rounded-lg bg-white border"><div class="text-xs text-gray-500">2.0x</div><div class="font-semibold num" id="s20">—</div></div>
              <div class="p-2 rounded-lg bg-white border"><div class="text-xs text-gray-500">2.2x</div><div class="font-semibold num" id="s22">—</div></div>
            </div>
            <p class="text-xs text-gray-500 mt-2">Fórmula: stake = lucro_dia / (multiplicador − 1). Ex.: para 2.0x, stake = lucro_dia.</p>
          </div>
          <div class="p-3 rounded-xl bg-gray-50">
            <div class="text-gray-500">Stop-loss (Dia 1)</div>
            <div class="text-xl font-bold num"><span id="slValor">—</span> MZN</div>
          </div>
          <div class="p-3 rounded-xl bg-gray-50">
            <div class="text-gray-500">Entradas por dia (máx)</div>
            <div class="text-xl font-bold" id="entrResumo">—</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tabela -->
    <section class="bg-white rounded-2xl shadow overflow-hidden">
      <div class="px-4 py-3 flex items-center justify-between">
        <h2 class="text-lg font-semibold">Evolução diária (plano composto)</h2>
        <div class="text-xs text-gray-500">Valores arredondados. Stop-win = lucro do dia.</div>
      </div>
      <div class="overflow-auto max-h-[65vh]">
        <table class="w-full text-sm">
          <thead>
            <tr class="sticky-th">
              <th class="text-left p-2">Dia</th>
              <th class="text-left p-2">Data</th>
              <th class="text-right p-2">Banca Início</th>
              <th class="text-right p-2">Lucro Meta</th>
              <th class="text-right p-2">Stop-loss</th>
              <th class="text-right p-2">Stake 1.5x</th>
              <th class="text-right p-2">Stake 1.8x</th>
              <th class="text-right p-2">Stake 2.0x</th>
              <th class="text-right p-2">Stake 2.2x</th>
              <th class="text-right p-2">Banca Final</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>

    <footer class="text-xs text-gray-500 mt-6">
      <p>Disciplina recomendada: 3–5 entradas/dia; atingir <span class="num">stop-win</span> e encerrar; respeitar <span class="num">stop-loss</span> diário.</p>
    </footer>
  </main>

  <script>
    const fmt = (n) => new Intl.NumberFormat('pt-MZ', {maximumFractionDigits: 2}).format(n);
    const fmtPct = (n) => new Intl.NumberFormat('pt-MZ', {maximumFractionDigits: 3}).format(n);

    function daysInclusive(d1, d2){
      const ms = (d2 - d1) / (1000*60*60*24);
      return Math.floor(ms) + 1;
    }

    function recalc(){
      const banca = Number(document.getElementById('banca').value || 0);
      const meta = Number(document.getElementById('meta').value || 0);
      const inicio = new Date(document.getElementById('inicio').value);
      const fim = new Date(document.getElementById('fim').value);
      const entradas = Number(document.getElementById('entradas').value || 1);
      const slPct = Number(document.getElementById('slPct').value || 0);

      if(!banca || !meta || !(inicio instanceof Date) || !(fim instanceof Date) || isNaN(inicio) || isNaN(fim) || fim < inicio){
        alert('Verifique os parâmetros.');
        return;
      }

      const N = daysInclusive(inicio, fim);
      document.getElementById('dias').textContent = N;
      document.getElementById('periodo').textContent = `${inicio.toLocaleDateString('pt-PT')} → ${fim.toLocaleDateString('pt-PT')}`;

      const r = Math.pow(meta / banca, 1 / N) - 1; // taxa diária composta
      document.getElementById('rPct').textContent = fmtPct(r * 100) + '%';
      document.getElementById('entrResumo').textContent = entradas;

      // Dia 1
      const lucroDia1 = banca * r;
      document.getElementById('lucroDia1').textContent = fmt(lucroDia1);
      document.getElementById('s15').textContent = fmt(lucroDia1 / (1.5 - 1));
      document.getElementById('s18').textContent = fmt(lucroDia1 / (1.8 - 1));
      document.getElementById('s20').textContent = fmt(lucroDia1 / (2.0 - 1));
      document.getElementById('s22').textContent = fmt(lucroDia1 / (2.2 - 1));
      document.getElementById('slValor').textContent = fmt(banca * slPct / 100);

      // Tabela
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '';

      let B = banca;
      for(let i=1; i<=N; i++){
        const d = new Date(inicio);
        d.setDate(inicio.getDate() + (i-1));
        const lucro = B * r;
        const SL = B * slPct / 100;
        const stake15 = lucro / (1.5 - 1);
        const stake18 = lucro / (1.8 - 1);
        const stake20 = lucro / (2.0 - 1);
        const stake22 = lucro / (2.2 - 1);
        const Bfim = B * (1 + r);

        const tr = document.createElement('tr');
        const cells = [
          i,
          d.toLocaleDateString('pt-PT'),
          fmt(B),
          fmt(lucro),
          fmt(SL),
          fmt(stake15),
          fmt(stake18),
          fmt(stake20),
          fmt(stake22),
          fmt(Bfim),
        ];
        cells.forEach((c, idx)=>{
          const td = document.createElement('td');
          td.className = 'p-2 ' + (idx>=2 ? 'text-right num' : '');
          td.textContent = c;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
        B = Bfim;
      }

      // CSV export data cache
      window.__export = {banca, meta, inicio, fim, N, r, slPct};
    }

    function exportCSV(){
      if(!window.__export){ return; }
      const {banca, meta, inicio, fim, N, r, slPct} = window.__export;
      let B = banca;
      let lines = [
        ['Dia','Data','Banca Inicio','Lucro Meta','Stop-loss','Stake 1.5x','Stake 1.8x','Stake 2.0x','Stake 2.2x','Banca Final']
      ];
      for(let i=1; i<=N; i++){
        const d = new Date(inicio);
        d.setDate(inicio.getDate() + (i-1));
        const lucro = B * r;
        const SL = B * slPct / 100;
        const row = [
          i,
          d.toISOString().slice(0,10),
          B.toFixed(2),
          lucro.toFixed(2),
          SL.toFixed(2),
          (lucro/(1.5-1)).toFixed(2),
          (lucro/(1.8-1)).toFixed(2),
          (lucro/(2.0-1)).toFixed(2),
          (lucro/(2.2-1)).toFixed(2),
          (B*(1+r)).toFixed(2)
        ];
        lines.push(row);
        B = B * (1 + r);
      }
      const csv = lines.map(a=>a.join(',')).join('\n');
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'plano_diario_2000_para_300000.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    document.getElementById('recalcular').addEventListener('click', recalc);
    document.getElementById('exportar').addEventListener('click', exportCSV);
    document.getElementById('imprimir').addEventListener('click', ()=> window.print());

    // inicializa
    recalc();
  </script>
</body>
</html>
